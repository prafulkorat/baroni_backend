import User from '../models/User.js';

// Gold Baroni IDs from the provided list (5-digit special IDs)
const GOLD_BARONI_IDS = [
  '00000','00001','00002','00003','00004','00005','00006','00007','00008','00009','01111','02222','03333','04444','05555','06666','07777','08888','09999','10000','11110','11111','11112','11113','11114','11115','11116','11117','11118','11119','12222','13333','14444','15555','16666','17777','18888','19999','20000','21111','22220','22221','22222','22223','22224','22225','22226','22227','22228','22229','23333','24444','25555','26666','27777','28888','29999','30000','31111','32222','33330','33331','33332','33333','33334','33335','33336','33337','33338','33339','34444','35555','36666','37777','38888','39999','40000','41111','42222','43333','44440','44441','44442','44443','44444','44445','44446','44447','44448','44449','45555','46666','47777','48888','49999','50000','51111','52222','53333','54444','55550','55551','55552','55553','55554','55555','55556','55557','55558','55559','56666','57777','58888','59999','60000','61111','62222','63333','64444','65555','66660','66661','66662','66663','66664','66665','66666','66667','66668','66669','67777','68888','69999','70000','71111','72222','73333','74444','75555','76666','77770','77771','77772','77773','77774','77775','77776','77777','77778','77779','78888','79999','80000','81111','82222','83333','84444','85555','86666','87777','88880','88881','88882','88883','88884','88885','88886','88887','88888','88889','89999','90000','91111','92222','93333','94444','95555','96666','97777','98888','99990','99991','99992','99993','99994','99995','99996','99997','99998','99999','00010','00011','00012','00013','00014','00015','00016','00017','00018','00019','00020','00021','00022','00023','00024','00025','00026','00027','00028','00029','00030','00031','00032','00033','00034','00035','00036','00037','00038','00039','00040','00041','00042','00043','00044','00045','00046','00047','00048','00049','00050','00051','00052','00053','00054','00055','00056','00057','00058','00059','00060','00061','00062','00063','00064','00065','00066','00067','00068','00069','00070','00071','00072','00073','00074','00075','00076','00077','00078','00079','00080','00081','00082','00083','00084','00085','00086','00087','00088','00089','00090','00091','00092','00093','00094','00095','00096','00097','00098','00099','00111','00222','00333','00444','00555','00666','00777','00888','00999','01000','01110','01112','01113','01114','01115','01116','01117','01118','01119','01222','01333','01444','01555','01666','01777','01888','01999','02000','02111','02220','02221','02223','02224','02225','02226','02227','02228','02229','02333','02444','02555','02666','02777','02888','02999','03000','03111','03222','03330','03331','03332','03334','03335','03336','03337','03338','03339','03444','03555','03666','03777','03888','03999','04000','04111','04222','04333','04440','04441','04442','04443','04445','04446','04447','04448','04449','04555','04666','04777','04888','04999','05000','05111','05222','05333','05444','05550','05551','05552','05553','05554','05556','05557','05558','05559','05666','05777','05888','05999','06000','06111','06222','06333','06444','06555','06660','06661','06662','06663','06664','06665','06667','06668','06669','06777','06888','06999','07000','07111','07222','07333','07444','07555','07666','07770','07771','07772','07773','07774','07775','07776','07778','07779','07888','07999','08000','08111','08222','08333','08444','08555','08666','08777','08880','08881','08882','08883','08884','08885','08886','08887','08889','08999','09000','09111','09222','09333','09444','09555','09666','09777','09888','09990','09991','09992','09993','09994','09995','09996','09997','09998','10001','10002','10003','10004','10005','10006','10007','10008','10009','10111','10222','10333','10444','10555','10666','10777','10888','10999','11000','11100','11101','11102','11103','11104','11105','11106','11107','11108','11109','11120','11121','11122','11123','11124','11125','11126','11127','11128','11129','11130','11131','11132','11133','11134','11135','11136','11137','11138','11139','11140','11141','11142','11143','11144','11145','11146','11147','11148','11149','11150','11151','11152','11153','11154','11155','11156','11157','11158','11159','11160','11161','11162','11163','11164','11165','11166','11167','11168','11169','11170','11171','11172','11173','11174','11175','11176','11177','11178','11179','11180','11181','11182','11183','11184','11185','11186','11187','11188','11189','11190','11191','11192','11193','11194','11195','11196','11197','11198','11199','11222','11333','11444','11555','11666','11777','11888','11999','12000','12111','12220','12221','12223','12224','12225','12226','12227','12228','12229','12333','12444','12555','12666','12777','12888','12999','13000','13111','13222','13330','13331','13332','13334','13335','13336','13337','13338','13339','13444','13555','13666','13777','13888','13999','14000','14111','14222','14333','14440','14441','14442','14443','14445','14446','14447','14448','14449','14555','14666','14777','14888','14999','15000','15111','15222','15333','15444','15550','15551','15552','15553','15554','15556','15557','15558','15559','15666','15777','15888','15999','16000','16111','16222','16333','16444','16555','16660','16661','16662','16663','16664','16665','16667','16668','16669','16777','16888','16999','17000','17111','17222','17333','17444','17555','17666','17770','17771','17772','17773','17774','17775','17776','17778','17779','17888','17999','18000','18111','18222','18333','18444','18555','18666','18777','18880','18881','18882','18883','18884','18885','18886','18887','18889','18999','19000','19111','19222','19333','19444','19555','19666','19777','19888','19990','19991','19992','19993','19994','19995','19996','19997','19998','20001','20002','20003','20004','20005','20006','20007','20008','20009','20111','20222','20333','20444','20555','20666','20777','20888','20999','21000','21110','21112','21113','21114','21115','21116','21117','21118','21119','21222','21333','21444','21555','21666','21777','21888','21999','22000','22111','22200','22201','22202','22203','22204','22205','22206','22207','22208','22209','22210','22211','22212','22213','22214','22215','22216','22217','22218','22219','22230','22231','22232','22233','22234','22235','22236','22237','22238','22239','22240','22241','22242','22243','22244','22245','22246','22247','22248','22249','22250','22251','22252','22253','22254','22255','22256','22257','22258','22259','22260','22261','22262','22263','22264','22265','22266','22267','22268','22269','22270','22271','22272','22273','22274','22275','22276','22277','22278','22279','22280','22281','22282','22283','22284','22285','22286','22287','22288','22289','22290','22291','22292','22293','22294','22295','22296','22297','22298','22299','22333','22444','22555','22666','22777','22888','22999','23000','23111','23222','23330','23331','23332','23334','23335','23336','23337','23338','23339','23444','23555','23666','23777','23888','23999','24000','24111','24222','24333','24440','24441','24442','24443','24445','24446','24447','24448','24449','24555','24666','24777','24888','24999','25000','25111','25222','25333','25444','25550','25551','25552','25553','25554','25556','25557','25558','25559','25666','25777','25888','25999','26000','26111','26222','26333','26444','26555','26660','26661','26662','26663','26664','26665','26667','26668','26669','26777','26888','26999','27000','27111','27222','27333','27444','27555','27666','27770','27771','27772','27773','27774','27775','27776','27778','27779','27888','27999','28000','28111','28222','28333','28444','28555','28666','28777','28880','28881','28882','28883','28884','28885','28886','28887','28889','28999','29000','29111','29222','29333','29444','29555','29666','29777','29888','29990','29991','29992','29993','29994','29995','29996','29997','29998','30001','30002','30003','30004','30005','30006','30007','30008','30009','30111','30222','30333','30444','30555','30666','30777','30888','30999','31000','31110','31112','31113','31114','31115','31116','31117','31118','31119','31222','31333','31444','31555','31666','31777','31888','31999','32000','32111','32220','32221','32223','32224','32225','32226','32227','32228','32229','32333','32444','32555','32666','32777','32888','32999','33000','33111','33222','33300','33301','33302','33303','33304','33305','33306','33307','33308','33309','33310','33311','33312','33313','33314','33315','33316','33317','33318','33319','33320','33321','33322','33323','33324','33325','33326','33327','33328','33329','33340','33341','33342','33343','33344','33345','33346','33347','33348','33349','33350','33351','33352','33353','33354','33355','33356','33357','33358','33359','33360','33361','33362','33363','33364','33365','33366','33367','33368','33369','33370','33371','33372','33373','33374','33375','33376','33377','33378','33379','33380','33381','33382','33383','33384','33385','33386','33387','33388','33389','33390','33391','33392','33393','33394','33395','33396','33397','33398','33399','33444','33555','33666','33777','33888','33999','34000','34111','34222','34333','34440','34441','34442','34443','34445','34446','34447','34448','34449','34555','34666','34777','34888','34999','35000','35111','35222','35333','35444','35550','35551','35552','35553','35554','35556','35557','35558','35559','35666','35777','35888','35999','36000','36111','36222','36333','36444','36555','36660','36661','36662','36663','36664','36665','36667','36668','36669','36777','36888','36999','37000','37111','37222','37333','37444','37555','37666','37770','37771','37772','37773','37774','37775','37776','37778','37779','37888','37999','38000','38111','38222','38333','38444','38555','38666','38777','38880','38881','38882','38883','38884','38885','38886','38887','38889','38999','39000','39111','39222','39333','39444','39555','39666','39777','39888','39990','39991','39992','39993','39994','39995','39996','39997','39998','40001','40002','40003','40004','40005','40006','40007','40008','40009','40111','40222','40333','40444','40555','40666','40777','40888','40999','41000','41110','41112','41113','41114','41115','41116','41117','41118','41119','41222','41333','41444','41555','41666','41777','41888','41999','42000','42111','42220','42221','42223','42224','42225','42226','42227','42228','42229','42333','42444','42555','42666','42777','42888','42999','43000','43111','43222','43330','43331','43332','43334','43335','43336','43337','43338','43339','43444','43555','43666','43777','43888','43999','44000','44111','44222','44333','44400','44401','44402','44403','44404','44405','44406','44407','44408','44409','44410','44411','44412','44413','44414','44415','44416','44417','44418','44419','44420','44421','44422','44423','44424','44425','44426','44427','44428','44429','44430','44431','44432','44433','44434','44435','44436','44437','44438','44439','44450','44451','44452','44453','44454','44455','44456','44457','44458','44459','44460','44461','44462','44463','44464','44465','44466','44467','44468','44469','44470','44471','44472','44473','44474','44475','44476','44477','44478','44479','44480','44481','44482','44483','44484','44485','44486','44487','44488','44489','44490','44491','44492','44493','44494','44495','44496','44497','44498','44499','44555','44666','44777','44888','44999','45000','45111','45222','45333','45444','45550','45551','45552','45553','45554','45556','45557','45558','45559','45666','45777','45888','45999','46000','46111','46222','46333','46444','46555','46660','46661','46662','46663','46664','46665','46667','46668','46669','46777','46888','46999','47000','47111','47222','47333','47444','47555','47666','47770','47771','47772','47773','47774','47775','47776','47778','47779','47888','47999','48000','48111','48222','48333','48444','48555','48666','48777','48880','48881','48882','48883','48884','48885','48886','48887','48889','48999','49000','49111','49222','49333','49444','49555','49666','49777','49888','49990','49991','49992','49993','49994','49995','49996','49997','49998','50001','50002','50003','50004','50005','50006','50007','50008','50009','50111','50222','50333','50444','50555','50666','50777','50888','50999','51000','51110','51112','51113','51114','51115','51116','51117','51118','51119','51222','51333','51444','51555','51666','51777','51888','51999','52000','52111','52220','52221','52223','52224','52225','52226','52227','52228','52229','52333','52444','52555','52666','52777','52888','52999','53000','53111','53222','53330','53331','53332','53334','53335','53336','53337','53338','53339','53444','53555','53666','53777','53888','53999','54000','54111','54222','54333','54440','54441','54442','54443','54445','54446','54447','54448','54449','54555','54666','54777','54888','54999','55000','55111','55222','55333','55444','55500','55501','55502','55503','55504','55505','55506','55507','55508','55509','55510','55511','55512','55513','55514','55515','55516','55517','55518','55519','55520','55521','55522','55523','55524','55525','55526','55527','55528','55529','55530','55531','55532','55533','55534','55535','55536','55537','55538','55539','55540','55541','55542','55543','55544','55545','55546','55547','55548','55549','55560','55561','55562','55563','55564','55565','55566','55567','55568','55569','55570','55571','55572','55573','55574','55575','55576','55577','55578','55579','55580','55581','55582','55583','55584','55585','55586','55587','55588','55589','55590','55591','55592','55593','55594','55595','55596','55597','55598','55599','55666','55777','55888','55999','56000','56111','56222','56333','56444','56555','56660','56661','56662','56663','56664','56665','56667','56668','56669','56777','56888','56999','57000','57111','57222','57333','57444','57555','57666','57770','57771','57772','57773','57774','57775','57776','57778','57779','57888','57999','58000','58111','58222','58333','58444','58555','58666','58777','58880','58881','58882','58883','58884','58885','58886','58887','58889','58999','59000','59111','59222','59333','59444','59555','59666','59777','59888','59990','59991','59992','59993','59994','59995','59996','59997','59998','60001','60002','60003','60004','60005','60006','60007','60008','60009','60111','60222','60333','60444','60555','60666','60777','60888','60999','61000','61110','61112','61113','61114','61115','61116','61117','61118','61119','61222','61333','61444','61555','61666','61777','61888','61999','62000','62111','62220','62221','62223','62224','62225','62226','62227','62228','62229','62333','62444','62555','62666','62777','62888','62999','63000','63111','63222','63330','63331','63332','63334','63335','63336','63337','63338','63339','63444','63555','63666','63777','63888','63999','64000','64111','64222','64333','64440','64441','64442','64443','64445','64446','64447','64448','64449','64555','64666','64777','64888','64999','65000','65111','65222','65333','65444','65550','65551','65552','65553','65554','65556','65557','65558','65559','65666','65777','65888','65999','66000','66111','66222','66333','66444','66555','66600','66601','66602','66603','66604','66605','66606','66607','66608','66609','66610','66611','66612','66613','66614','66615','66616','66617','66618','66619','66620','66621','66622','66623','66624','66625','66626','66627','66628','66629','66630','66631','66632','66633','66634','66635','66636','66637','66638','66639','66640','66641','66642','66643','66644','66645','66646','66647','66648','66649','66650','66651','66652','66653','66654','66655','66656','66657','66658','66659','66670','66671','66672','66673','66674','66675','66676','66677','66678','66679','66680','66681','66682','66683','66684','66685','66686','66687','66688','66689','66690','66691','66692','66693','66694','66695','66696','66697','66698','66699','66777','66888','66999','67000','67111','67222','67333','67444','67555','67666','67770','67771','67772','67773','67774','67775','67776','67778','67779','67888','67999','68000','68111','68222','68333','68444','68555','68666','68777','68880','68881','68882','68883','68884','68885','68886','68887','68889','68999','69000','69111','69222','69333','69444','69555','69666','69777','69888','69990','69991','69992','69993','69994','69995','69996','69997','69998','70001','70002','70003','70004','70005','70006','70007','70008','70009','70111','70222','70333','70444','70555','70666','70777','70888','70999','71000','71110','71112','71113','71114','71115','71116','71117','71118','71119','71222','71333','71444','71555','71666','71777','71888','71999','72000','72111','72220','72221','72223','72224','72225','72226','72227','72228','72229','72333','72444','72555','72666','72777','72888','72999','73000','73111','73222','73330','73331','73332','73334','73335','73336','73337','73338','73339','73444','73555','73666','73777','73888','73999','74000','74111','74222','74333','74440','74441','74442','74443','74445','74446','74447','74448','74449','74555','74666','74777','74888','74999','75000','75111','75222','75333','75444','75550','75551','75552','75553','75554','75556','75557','75558','75559','75666','75777','75888','75999','76000','76111','76222','76333','76444','76555','76660','76661','76662','76663','76664','76665','76667','76668','76669','76777','76888','76999','77000','77111','77222','77333','77444','77555','77666','77700','77701','77702','77703','77704','77705','77706','77707','77708','77709','77710','77711','77712','77713','77714','77715','77716','77717','77718','77719','77720','77721','77722','77723','77724','77725','77726','77727','77728','77729','77730','77731','77732','77733','77734','77735','77736','77737','77738','77739','77740','77741','77742','77743','77744','77745','77746','77747','77748','77749','77750','77751','77752','77753','77754','77755','77756','77757','77758','77759','77760','77761','77762','77763','77764','77765','77766','77767','77768','77769','77780','77781','77782','77783','77784','77785','77786','77787','77788','77789','77790','77791','77792','77793','77794','77795','77796','77797','77798','77799','77888','77999','78000','78111','78222','78333','78444','78555','78666','78777','78880','78881','78882','78883','78884','78885','78886','78887','78889','78999','79000','79111','79222','79333','79444','79555','79666','79777','79888','79990','79991','79992','79993','79994','79995','79996','79997','79998','80001','80002','80003','80004','80005','80006','80007','80008','80009','80111','80222','80333','80444','80555','80666','80777','80888','80999','81000','81110','81112','81113','81114','81115','81116','81117','81118','81119','81222','81333','81444','81555','81666','81777','81888','81999','82000','82111','82220','82221','82223','82224','82225','82226','82227','82228','82229','82333','82444','82555','82666','82777','82888','82999','83000','83111','83222','83330','83331','83332','83334','83335','83336','83337','83338','83339','83444','83555','83666','83777','83888','83999','84000','84111','84222','84333','84440','84441','84442','84443','84445','84446','84447','84448','84449','84555','84666','84777','84888','84999','85000','85111','85222','85333','85444','85550','85551','85552','85553','85554','85556','85557','85558','85559','85666','85777','85888','85999','86000','86111','86222','86333','86444','86555','86660','86661','86662','86663','86664','86665','86667','86668','86669','86777','86888','86999','87000','87111','87222','87333','87444','87555','87666','87770','87771','87772','87773','87774','87775','87776','87778','87779','87888','87999','88000','88111','88222','88333','88444','88555','88666','88777','88800','88801','88802','88803','88804','88805','88806','88807','88808','88809','88810','88811','88812','88813','88814','88815','88816','88817','88818','88819','88820','88821','88822','88823','88824','88825','88826','88827','88828','88829','88830','88831','88832','88833','88834','88835','88836','88837','88838','88839','88840','88841','88842','88843','88844','88845','88846','88847','88848','88849','88850','88851','88852','88853','88854','88855','88856','88857','88858','88859','88860','88861','88862','88863','88864','88865','88866','88867','88868','88869','88870','88871','88872','88873','88874','88875','88876','88877','88878','88879','88890','88891','88892','88893','88894','88895','88896','88897','88898','88899','88999','89000','89111','89222','89333','89444','89555','89666','89777','89888','89990','89991','89992','89993','89994','89995','89996','89997','89998','90001','90002','90003','90004','90005','90006','90007','90008','90009','90111','90222','90333','90444','90555','90666','90777','90888','90999','91000','91110','91112','91113','91114','91115','91116','91117','91118','91119','91222','91333','91444','91555','91666','91777','91888','91999','92000','92111','92220','92221','92223','92224','92225','92226','92227','92228','92229','92333','92444','92555','92666','92777','92888','92999','93000','93111','93222','93330','93331','93332','93334','93335','93336','93337','93338','93339','93444','93555','93666','93777','93888','93999','94000','94111','94222','94333','94440','94441','94442','94443','94445','94446','94447','94448','94449','94555','94666','94777','94888','94999','95000','95111','95222','95333','95444','95550','95551','95552','95553','95554','95556','95557','95558','95559','95666','95777','95888','95999','96000','96111','96222','96333','96444','96555','96660','96661','96662','96663','96664','96665','96667','96668','96669','96777','96888','96999','97000','97111','97222','97333','97444','97555','97666','97770','97771','97772','97773','97774','97775','97776','97778','97779','97888','97999','98000','98111','98222','98333','98444','98555','98666','98777','98880','98881','98882','98883','98884','98885','98886','98887','98889','98999','99000','99111','99222','99333','99444','99555','99666','99777','99888','99900','99901','99902','99903','99904','99905','99906','99907','99908','99909','99910','99911','99912','99913','99914','99915','99916','99917','99918','99919','99920','99921','99922','99923','99924','99925','99926','99927','99928','99929','99930','99931','99932','99933','99934','99935','99936','99937','99938','99939','99940','99941','99942','99943','99944','99945','99946','99947','99948','99949','99950','99951','99952','99953','99954','99955','99956','99957','99958','99959','99960','99961','99962','99963','99964','99965','99966','99967','99968','99969','99970','99971','99972','99973','99974','99975','99976','99977','99978','99979','99980','99981','99982','99983','99984','99985','99986','99987','99988', '99989'
];

/**
* Generates a unique 5-digit standard baroni ID (random)
* @returns {Promise<string>} A unique 5-digit baroni ID
*/
export const generateUniqueBaroniId = async () => {
  let baroniId;
  let isUnique = false;
  let attempts = 0;
  const maxAttempts = 1000; // Prevent infinite loops
  
  while (!isUnique && attempts < maxAttempts) {
    // Generate a random 5-digit number (10000-99999)
    baroniId = Math.floor(10000 + Math.random() * 90000).toString();
    
    // Check if this ID already exists and is not a gold ID
    const existingUser = await User.findOne({ baroniId });
    const isGoldId = GOLD_BARONI_IDS.includes(baroniId);
    
    if (!existingUser && !isGoldId) {
      isUnique = true;
    }
    
    attempts++;
  }
  
  if (attempts >= maxAttempts) {
    throw new Error('Unable to generate unique Baroni ID after maximum attempts');
  }
  
  return baroniId;
};

/**
* Generates a unique GOLD baroni ID from the predefined list
* Ensures uniqueness against existing users' `baroniId`.
* @returns {Promise<string>} A unique GOLD baroni ID
*/
export const generateUniqueGoldBaroniId = async () => {
  // Get all currently used gold IDs
  const usedGoldIds = await User.find({ 
    baroniId: { $in: GOLD_BARONI_IDS } 
  }).select('baroniId').lean();
  
  const usedIdsSet = new Set(usedGoldIds.map(user => user.baroniId));
  
  // Find available gold IDs
  const availableGoldIds = GOLD_BARONI_IDS.filter(id => !usedIdsSet.has(id));
  
  if (availableGoldIds.length === 0) {
    throw new Error('No more gold Baroni IDs available');
  }
  
  // Return a random available gold ID
  const randomIndex = Math.floor(Math.random() * availableGoldIds.length);
  return availableGoldIds[randomIndex];
};

/**
* Checks if a baroni ID is a gold ID
* @param {string} baroniId - The baroni ID to check
* @returns {boolean} True if it's a gold ID, false otherwise
*/
export const isGoldBaroniId = (baroniId) => {
  return GOLD_BARONI_IDS.includes(baroniId);
};

/**
* Gets all available gold baroni IDs
* @returns {Promise<string[]>} Array of available gold baroni IDs
*/
export const getAvailableGoldBaroniIds = async () => {
  const usedGoldIds = await User.find({ 
    baroniId: { $in: GOLD_BARONI_IDS } 
  }).select('baroniId').lean();
  
  const usedIdsSet = new Set(usedGoldIds.map(user => user.baroniId));
  
  return GOLD_BARONI_IDS.filter(id => !usedIdsSet.has(id));
};

/**
* Gets all used gold baroni IDs
* @returns {Promise<string[]>} Array of used gold baroni IDs
*/
export const getUsedGoldBaroniIds = async () => {
  const usedGoldIds = await User.find({ 
    baroniId: { $in: GOLD_BARONI_IDS } 
  }).select('baroniId').lean();
  
  return usedGoldIds.map(user => user.baroniId);
};


